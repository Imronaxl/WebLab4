<div class="responsive-container">
  <div class="header surface-card p-3 shadow-2 flex justify-content-between align-items-center mb-3 rounded">
    <div class="text-lg font-bold">Лаб. №4 | Гулахмадзода Имрон | Группа: P3232 | Вариант: 32434212</div>
    <p-button label="Выйти" icon="pi pi-sign-out" severity="danger" (click)="logout()"></p-button>
  </div>

  <div class="grid-container">
    <div class="form-container">
      <p-card header="Параметры точки" class="h-full">
        <div class="flex flex-column gap-4">
          <div class="field">
            <label class="block mb-2 font-medium">Координата X:</label>
            <p-dropdown [options]="xOptions" [(ngModel)]="selectedX" placeholder="Выберите X" [style]="{'width': '100%'}"></p-dropdown>
          </div>
          <div class="field">
            <label class="block mb-2 font-medium">Координата Y (-5 ... 3):</label>
            <input pInputText type="number" [(ngModel)]="yValue" (input)="validateY()" [style]="{'width': '100%'}" placeholder="Введите Y" step="0.1" min="-5" max="3" />
            <small *ngIf="yError" class="p-error block mt-1">Y должен быть числом от -5 до 3</small>
          </div>
          <div class="field">
            <label class="block mb-2 font-medium">Радиус R:</label>
            <p-dropdown [options]="rOptions" [(ngModel)]="selectedR" (onChange)="onRadiusChange()" placeholder="Выберите R" [style]="{'width': '100%'}"></p-dropdown>
          </div>
          <div class="flex flex-column gap-2">
            <p-button label="Проверить точку" icon="pi pi-check" (click)="checkPoint()" [disabled]="yError || !selectedR || selectedX === null" class="w-full"></p-button>
            <p-button label="Очистить таблицу" icon="pi pi-trash" severity="secondary" (click)="clearPoints()" class="w-full"></p-button>
          </div>
          <div class="mt-4 p-3 border-round surface-section">
            <h4 class="mt-0 mb-2">Информация:</h4>
            <p class="text-sm mb-1">X: {{selectedX != null ? selectedX : 'не выбрано'}}</p>
            <p class="text-sm mb-1">Y: {{yValue || 'не введено'}}</p>
            <p class="text-sm mb-0">R: {{selectedR != null ? selectedR : 'не выбран'}}</p>
          </div>
        </div>
      </p-card>
    </div>

    <div class="canvas-container">
      <p-card header="Область на координатной плоскости" class="h-full">
        <div class="graph-outer">
          <canvas
            #canvas
            [style.width.px]="canvasSize"
            [style.height.px]="canvasSize"
            [attr.width]="canvasSize"
            [attr.height]="canvasSize"
            (click)="onCanvasClick($event)"
            class="graph-canvas"
          ></canvas>
        </div>
        <div class="mt-3 text-center text-sm text-color-secondary">Кликните на графике для добавления точки</div>
      </p-card>
    </div>
  </div>

  <div class="mt-4 table-container">
    <p-card header="Результаты проверок">
      <p-table [value]="points" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[5, 10, 20]" styleClass="p-datatable-sm" [tableStyle]="{'min-width': '50rem'}">
        <ng-template pTemplate="header">
          <tr>
            <th>X</th>
            <th>Y</th>
            <th>R</th>
            <th>Результат</th>
            <th>Время проверки</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-point>
          <tr>
            <td>{{point.x}}</td>
            <td>{{point.y}}</td>
            <td>{{point.r}}</td>
            <td><span [class]="point.hit ? 'hit' : 'miss'">{{point.hit ? 'Попал' : 'Мимо'}}</span></td>
            <td>{{point.checkDate}}</td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="5" class="text-center p-4">Нет данных</td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </div>
</div>
